const apikey="30bf3f5c";let cartLocalArray=JSON.parse(sessionStorage.getItem("cartArray"))||[];var total=0;let totalServiceProduct=0;function loadMovies(t){fetch(`https://omdbapi.com/?s=${t}&page=1&apikey=${apikey}`,{method:"GET"}).then(t=>t.json()).then(e=>{"True"==e.Response&&(totalServiceProduct=e.totalResults,console.log(totalServiceProduct),$(".total-product").text(totalServiceProduct+" Ürün"),displayMovieList(e.Search,t))})}function loadFilterMovies(t,e){const a=$(".dynamic-pr-list").attr("data-load");var r,n="https://www.omdbapi.com";"Year"==t?(r=`${n}/?s=${a}&y=${e}&page=1&apikey=${apikey}`,console.log(r)):r=`${n}/?s=${a}&type=${e}&page=1&apikey=${apikey}`,fetch(r,{method:"GET"}).then(t=>t.json()).then(t=>{"True"==t.Response&&(totalServiceProduct=t.totalResults,console.log(totalServiceProduct),$(".total-product").text(totalServiceProduct+" Ürün"),displayMovieList(t.Search,a))})}function loadFilterDoubleMovies(t,e,a){const r=$(".dynamic-pr-list").attr("data-load");fetch(`https://www.omdbapi.com/?s=${a}&y=${t}&type=${e}&page=1&apikey=${apikey}`,{method:"GET"}).then(t=>t.json()).then(t=>{"True"==t.Response&&(totalServiceProduct=t.totalResults,console.log(totalServiceProduct),$(".total-product").text(totalServiceProduct+" Ürün"),displayMovieList(t.Search,r))})}function loadFilters(t){fetch(`https://omdbapi.com/?s=${t}&page=1&apikey=${apikey}`,{method:"GET"}).then(t=>t.json()).then(t=>{"True"==t.Response&&displayFilters(t.Search)})}function displayFilters(t){$(".filter-wrapper");var e=[],a=[];for(let r=0;r<t.length;r++)e.push(`${t[r].Year}`),a.push(`${t[r].Type}`);let r=[...new Set(e)],n=[...new Set(a)];for(let t=0;t<r.length;t++)$('.filter-group[data-id="Year"]').find(".filter-options").append(`<span data-filter="${r[t]}" class="d-flex align-items-center">${r[t]}</span>`);for(let t=0;t<n.length;t++)$('.filter-group[data-id="Type"]').find(".filter-options").append(`<span data-filter="${n[t]}" class="d-flex align-items-center">${n[t]}</span>`);""!=linkVarControl("Year")&&$('.filter-options span[data-filter="'+linkVarControl("Year")+'"]').addClass("active"),""!=linkVarControl("Type")&&$('.filter-options span[data-filter="'+linkVarControl("Type")+'"]').addClass("active")}function loadPrMovies(t,e){var a=parseInt(e);let r;if(""!=linkVarControl("Year")&&""!=linkVarControl("Type")){const e=linkVarControl("Year"),n=linkVarControl("Type");r=`https://omdbapi.com/?s=${t}&y=${e}&type=${n}&page=${a}&apikey=${apikey}`}else if(""!=linkVarControl("Year")||""!=linkVarControl("Type"))if(""!=linkVarControl("Year")){const e=linkVarControl("Year");r=`https://omdbapi.com/?s=${t}&y=${e}&page=${a}&apikey=${apikey}`}else{const e=linkVarControl("Type");r=`https://omdbapi.com/?s=${t}&type=${e}&page=${a}&apikey=${apikey}`}else r=`https://omdbapi.com/?s=${t}&page=${a}&apikey=${apikey}`;fetch(r,{method:"GET"}).then(t=>t.json()).then(e=>{"True"==e.Response&&(totalServiceProduct=e.totalResults,console.log(totalServiceProduct),$(".total-product").text(totalServiceProduct+" Ürün"),displayMovieList(e.Search,t))})}function loadSearchMovies(t){fetch(`https://omdbapi.com/?s=${t}&page=1&apikey=${apikey}`,{method:"GET"}).then(t=>t.json()).then(t=>{"True"==t.Response&&displaySearchList(t.Search)})}function displayMovieList(t,e){const a=$('[data-load="'+e+'"]');for(let e=0;e<t.length;e++){let r=document.createElement("div");r.className="col-6 mb-5 col-lg-4 product-list-loop",r.dataset.id=t[e].imdbID,"N/A"!=t[e].Poster&&(moviePoster=t[e].Poster),r.innerHTML=`\n            <div class="product-item position-relative border">\n            <div class="position-relative">\n                <div class="position-absolute product-symbol left">\n                    <span class="new-badge bg-danger text-white px-3 py-1">YENİ</span>\n                    <span class="discounted-badge bg-success text-white px-3 py-1">%37</span>\n                </div>\n                <div class="position-absolute product-symbol right">\n                    <a href="#" class="pr-fav">\n                        <?xml version="1.0" encoding="iso-8859-1"?>\n                        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n                            viewBox="0 0 471.701 471.701" style="enable-background:new 0 0 471.701 471.701;" xml:space="preserve">\n                        <g>\n                            <path d="M433.601,67.001c-24.7-24.7-57.4-38.2-92.3-38.2s-67.7,13.6-92.4,38.3l-12.9,12.9l-13.1-13.1\n                                c-24.7-24.7-57.6-38.4-92.5-38.4c-34.8,0-67.6,13.6-92.2,38.2c-24.7,24.7-38.3,57.5-38.2,92.4c0,34.9,13.7,67.6,38.4,92.3\n                                l187.8,187.8c2.6,2.6,6.1,4,9.5,4c3.4,0,6.9-1.3,9.5-3.9l188.2-187.5c24.7-24.7,38.3-57.5,38.3-92.4\n                                C471.801,124.501,458.301,91.701,433.601,67.001z M414.401,232.701l-178.7,178l-178.3-178.3c-19.6-19.6-30.4-45.6-30.4-73.3\n                                s10.7-53.7,30.3-73.2c19.5-19.5,45.5-30.3,73.1-30.3c27.7,0,53.8,10.8,73.4,30.4l22.6,22.6c5.3,5.3,13.8,5.3,19.1,0l22.4-22.4\n                                c19.6-19.6,45.7-30.4,73.3-30.4c27.6,0,53.6,10.8,73.2,30.3c19.6,19.6,30.3,45.6,30.3,73.3\n                                C444.801,187.101,434.001,213.101,414.401,232.701z"/>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        <g>\n                        </g>\n                        </svg>\n                    </a>\n                    <span class="skin-badge bg-primary text-white px-2 py-1">${t[e].Type}</span>\n                </div>\n                <a onclick="loadPrDetail('${t[e].imdbID}');" class="product-image-wrapper">\n                    <figure class="product-image-figure">\n                        <img src="${moviePoster}" alt="${t[e].Title}" class="img-fluid" />\n                    </figure>\n                </a>\n            </div>\n            <div class="product-cart-detail position-relative pt-4 pb-3">\n                <a onclick="loadPrDetail('${t[e].imdbID}');" class="product-title text-center text-uppercase text-dark mb-4">${t[e].Title}</a>\n                <div class="product-price d-flex align-items-center justify-content-center mb-3">\n                    <span class="price-not-discounted text-delete text-gray">${t[e].Year} TL</span>\n                    <span class="product-sale font-weight-bold text-dark ml-2">499,90 TL</span>\n                </div>\n                <div class="product-price-cart text-center text-danger font-weight-bold">Sepette 299,00 TL</div>\n            </div>\n        </div>\n        `,$(a).append(r)}}function displaySearchList(t){const e=$(".search-pr-loader");let a="";$(e).html(" "),a=t.length>4?4:t.length;for(let r=0;r<a;r++){let a=document.createElement("div");a.className="col-6 col-lg-3 product-item product-item-search",a.dataset.id=t[r].imdbID,"N/A"!=t[r].Poster&&(moviePoster=t[r].Poster),a.innerHTML=`\n            <div class="product-s-border border d-flex flex-column">\n                <a onclick="loadPrDetail('${t[r].imdbID}');" class="product-image-wrapper">\n                    <figure class="product-image-figure">\n                    <img src="${moviePoster}" alt="${t[r].Title}" class="img-fluid" />\n                    </figure>\n                </a>\n                <div class="position-relative product-search-other d-flex flex-column">\n                    <a onclick="loadPrDetail(${t[r].imdbID});" class="product-title text-left text-dark mb-1">${t[r].Title}</a>\n                    <span class="search-not-disc price-not-discounted text-delete text-gray">${t[r].Year} TL</span>\n                    <span class="search-sale product-sale font-weight-bold text-dark">299,90 TL</span>\n                </div>\n            </div>\n        `,$(e).append(a)}}function searchMovies(){let t=$("#input-search").val().trim();t.length>0&&($(".search-pr-loader").innerHTML="",$(".search-title").text("Arama Sonuçları"),loadSearchMovies(t))}function loadPrDetail(t){fetch(`http://www.omdbapi.com/?i=${t}&apikey=${apikey}`,{method:"GET"}).then(t=>t.json()).then(t=>{"True"==t.Response&&((cartLocalArray=JSON.parse(sessionStorage.getItem("cartArray"))||[]).push(t.imdbID),sessionStorage.setItem("cartArray",JSON.stringify(cartLocalArray)),loadCart())})}function cartQtyControl(){if(null==sessionStorage.getItem("cartArray")||"[]"==sessionStorage.getItem("cartArray"))$(".cart-soft-count").text("0"),$(".cart-wrapper").addClass("empty").removeClass("full");else{const t=listArray(JSON.parse(sessionStorage.getItem("cartArray")));$(".cart-soft-count").text(t.length),$(".cart-wrapper").addClass("full").removeClass("empty")}}function loadCart(){let t="";const e=listArray(JSON.parse(sessionStorage.getItem("cartArray")));$(".cart-full").html(" ");for(let a=0;a<e.length;a++)t=`http://www.omdbapi.com/?i=${e[a][1]}&apikey=${apikey}`,fetch(t,{method:"GET"}).then(t=>t.json()).then(t=>{if("True"==t.Response){const r=$(".cart-full");let n=document.createElement("div");n.className="cart-product col-12 px-0",n.dataset.id=t.imdbID,n.dataset.class=e[a][0],"N/A"!=t.Poster&&(moviePoster=t.Poster),n.innerHTML=`\n                <div class="row d-flex align-items-center">\n                    <div class="col-6 cart-pr-image">\n                        <a href="#" class="product-image-wrapper">\n                            <figure class="product-image-figure">\n                                <img src="${moviePoster}" alt="${t.Title}" class="img-fluid" />\n                            </figure>\n                        </a>\n                    </div>\n                    <div class="col-6">\n                        <a onclick="cartDelete('${t.imdbID}');" class="d-flex cart-pr-remove">Ürünü Sil</a>\n                    </div>\n                </div>\n                <div class="row d-flex flex-direction-column cart-pr-other">\n                    <span class="d-flex align-items-center cart-pr-name">${t.Title}</span>\n                    <span class="d-flex align-items-center cart-prices-wrap">\n                        <span class="cart-not-disc price-not-discounted text-delete text-gray">${t.Year} TL</span>\n                        <span data-price="299,90" class="cart-sale product-sale font-weight-bold text-danger ml-2">299,90 TL</span>\n                    </span>\n                    <span class="d-flex align-items-center cart-color">Renk: ${t.Rated}</span>\n                    <span class="d-flex align-items-center cart-size">Beden: ${t.Metascore}</span>\n                    <div class="w-100 d-flex align-items-center cart-pr-qty">\n                        <span class="cart-qty-title">Adet</span>\n                        <div class="cart-qty-box">\n                            <span class="qty-minus" onclick="qtyMinus('${t.imdbID}')">-</span>\n                            <span class="qty-number">${e[a][0]}</span>\n                            <span class="qty-plus" onclick="loadPrDetail('${t.imdbID}')">+</span>\n                        </div>\n                    </div>\n                </div>\n                `,$(r).append(n),priceCalculator()}});cartQtyControl()}function listArray(t){var e=[];t.forEach(function(t){e[t]=(e[t]||0)+1});var a=[];for(var r in e)a.push([e[r],r]);return a.sort(function(t,e){return e[0]-t[0]}),a}function cartDelete(t){var e=JSON.parse(sessionStorage.getItem("cartArray")).filter(e=>e!==t);sessionStorage.setItem("cartArray",JSON.stringify(e)),loadCart()}function priceCalculator(){var t=0;$(".cart-product").each(function(e,a){var r=parseFloat($(a).find(".cart-sale").attr("data-price").replace(",",".")).toFixed(2),n=$(a).find(".qty-number").text(),o=parseFloat(r)*n;t+=parseFloat(o)}),$(".cart-total-load").text(t.toFixed(2)+" TL")}function qtyMinus(t){let e=JSON.parse(sessionStorage.getItem("cartArray"));for(let a=0;a<e.length;a++)if(e[a]===t){console.log("if içine girdi");e.splice(a,1);sessionStorage.setItem("cartArray",JSON.stringify(e)),a=e.length}loadCart()}function dynamicControl(){setTimeout(function(){var t=$(".product-list-loop").length,e=$(".product-loader-wrap").attr("data-page"),a=document.documentElement.scrollHeight-document.documentElement.clientHeight-document.querySelector("footer").clientHeight,r=document.body.scrollTop||document.documentElement.scrollTop;if(r>a&&r<a+170){var n=(parseInt(t)+10)/10;if(n>e&&parseInt(totalServiceProduct)/10+1>n){var o=$(".dynamic-pr-list").attr("data-load");$(".product-loader-wrap").attr("data-page",n),loadPrMovies(o,n)}}},2e3)}function linkControl(t,e,a){var r=new RegExp("[?&]"+t+"=","g"),n=a||window.location.href;return r.test(n)?(r=new RegExp("([?&]"+t+"=)(.*?)&","g")).test(n)?n=n.replace(r,"$1"+e+"&"):(r=new RegExp("([?&]"+t+"=)(.*?)$","g"),n=n.replace(r,"$1"+e)):/\?/g.test(n)?n+="&"+t+"="+e:n+="?"+t+"="+e,""===e&&(r=new RegExp("([?&])"+t+"=[^?&]*&?","g"),n=n.replace(r,"$1")),n=n.replace(/[?&]$/g,""),"pg"!==t&&(n=n.replace(/(\?|\&)pg=\d+/gi,"$1pg=1")),n}function linkVarControl(t){var e,a=window.location.search.substring(1);if(""!=a||"Kid"!=t&&"Uid"!=t&&"MarkaId"!=t&&"ModelId"!=t){e=a.split("&");for(o=0;o<e.length;o++){var r=e[o].split("=");if(r[0]==t)return r[1]}}else{e=(a=window.location.toString()).split("/"),e=(a=e[e.length-1]).split(",");var n=new Array;n.Kid=/\K\d+$/,n.Uid=/\U\d+$/,n.MarkaId=/\M\d+$/,n.ModelId=/\Y\d+$/;for(var o=0;o<e.length;o++)if(n[t].test(e[o]))return e[o].substr(1)}return""}function filterRemove(){let t=window.location.pathname;window.location.href=t}function filterGo(){let t=window.location.pathname,e=[],a=[];if($(".filter-options").each(function(t,r){$(r).find(".active").each(function(t,n){var o=$(r).attr("data-filter"),i=$(n).attr("data-filter");"Year"==o&&e.push(i),"Type"==o&&a.push(i)})}),""!=e&&""!=a)var r=t+"?Year="+e[0]+"&Type="+a[0];else if(""!=e)r=t+"?Year="+e[0];else if(""!=a)r=t+"?Type="+a[0];else r=t;window.location.href=r}$(document).ready(function(){if(""!=window.location.search){if(""!=linkVarControl("Year")&&""!=linkVarControl("Type")){loadFilterDoubleMovies(linkVarControl("Year"),linkVarControl("Type"),$(".dynamic-pr-list").attr("data-load"))}else""!=linkVarControl("Year")&&loadFilterMovies("Year",linkVarControl("Year")),""!=linkVarControl("Type")&&loadFilterMovies("Type",linkVarControl("Type"));loadFilters($(".dynamic-pr-list").attr("data-load"))}else $(".dynamic-pr-list").each(function(t,e){loadMovies($(e).attr("data-load"))}),loadFilters($(".dynamic-pr-list").attr("data-load"));cartQtyControl(),null!=sessionStorage.getItem("cartArray")&&loadCart(),window.onscroll=function(){dynamicControl()}}),$(document).on("click",".filter-options > span",function(){$(this).toggleClass("active").siblings().removeClass("active")}),$(document).on("click",".h-search",function(t){t.preventDefault(),t.stopPropagation(),$(this).addClass("active"),$(".search-all-wrap").addClass("active")}),$(document).on("click",".search-close",function(t){$(".h-search").removeClass("active"),$(".search-all-wrap").removeClass("active")}),$(document).on("click",".h-cart",function(t){t.preventDefault(),t.stopPropagation(),$(".cart-wrapper").addClass("active")}),$(document).on("click",".cart-close",function(t){$(".cart-wrapper").removeClass("active")});